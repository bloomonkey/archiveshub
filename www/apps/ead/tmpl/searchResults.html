<%inherit file="dual.html"/>
<%!
    # Over-ride global attributes
    page_title = "Search :: Results"
    leftcol_class = "search"
    rightcol_class = "facets"
%>
<%block name="leftcol">
	<p class="hitreport">
        ${queryString}
        There are ${len(resultSet)} hits.
	</p>
	
	${displaying(resultSet, sortBy, maximumRecords, startRecord)}
    
    <table>
	% for rsi in resultSet[startRecord - 1: min(startRecord + maximumRecords - 1, len(resultSet))]:
        <tr>
            <td>${rsi.id}</td>
        </tr>
	% endfor
    </table>

	${displaying(resultSet, sortBy, maximumRecords, startRecord)}

	% if len(resultSet) > maximumRecords and startRecord > 1:
        ${maximumRecordsSelect(resultSet, sortBy, maximumRecords, startRecord)}
		${back_links(resultSet, maximumRecords, startRecord)}
	% endif
	
</%block>

<%block name="rightcol">
	% if facets:
		<h3>Filter your results by:</h3>
		% for facet in facets:
			${format_facet(facet)}
		% endfor
	% endif
</%block>

<%def name="back_links(resultSet, maximumRecords, startRecord)">
	<div class="backlinks">
		<a 
			href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=1&amp;maximumRecords=${maximumRecords}#leftcol"
			class="ajax">
			<img src="${config.get('icons', 'fast-rewind-url')|u}" alt="|&lt;&lt;">
		</a>
	    <a
			href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${max(startRecord - maximumRecords, 1)}&amp;maximumRecords=${maximumRecords}&amp;#leftcol"
			class="ajax">
			<img src="${config.get('icons', 'rewind-url')|u}" alt="&lt;&lt;">
	    </a>
    </div>
</%def>

<%def name="displaying(resultSet, sortBy, maximumRecords, startRecord)">
    <div class="displaying">
        Displaying <strong>${startRecord}</strong>
        to <strong>${min(startRecord + maximumRecords - 1, len(resultSet))}</strong>
        of ${len(resultSet)}.
    </div>
</%def>

<%def name="sortBySelect(resultSet, sortBy, maximumRecords, startRecord)">
    <div class="sortBy">
        <form action="${SCRIPT}/search.html">
            <input type="hidden" name="rsid" value="${resultSet.id}"/>
            <select name="sortBy">
                % for val, label in [('weight', 'Relevance')]:
                    <option value="${val}">${label}</option>
                % endfor
            </select>
        </form>
    </div>
</%def>

<%def name="maximumRecordsSelect(resultSet, sortBy, maximumRecords, startRecord)">
    <div class="maximumRecords">
        <a 
            href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=20#leftcol"
            class="ajax maximumRecords">
            20
        </a>
        % if len(resultSet) >= 100:
            <a 
                href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=50#leftcol"
                class="ajax maximumRecords">
                50
            </a>
        % endif
        % if len(resultSet) >= 200:
            <a 
                href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=100#leftcol"
                class="ajax maximumRecords">
                100
            </a>
        % endif
        <a 
            href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=${len(resultSet)}#leftcol"
            class="ajax maximumRecords">
            all
        </a>
    </div>
</%def>

<%def name="format_facet(facet)">
</%def>
