<%!
    # Imports
    from cheshire3.utils import flattenTexts
%>
<%def name="back_links(resultSet, maximumRecords, startRecord)">
    <div class="backlinks">
        <a 
            href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=1&amp;maximumRecords=${maximumRecords}#leftcol"
            class="ajax">
            <img src="${config.get('icons', 'fast-rewind-url')|u}" alt="|&lt;&lt;">
        </a>
        <a
            href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${max(startRecord - maximumRecords, 1)}&amp;maximumRecords=${maximumRecords}&amp;#leftcol"
            class="ajax">
            <img src="${config.get('icons', 'rewind-url')|u}" alt="&lt;&lt;">
        </a>
    </div>
</%def>

<%def name="displaying(resultSet, sortBy, maximumRecords, startRecord)">
    <div class="displaying">
        Displaying <strong>${startRecord}</strong>
        to <strong>${min(startRecord + maximumRecords - 1, len(resultSet))}</strong>
        of ${len(resultSet)}.
    </div>
</%def>

<%def name="sortBySelect(resultSet, sortBy, maximumRecords, startRecord)">
    <div class="sortBy">
        <form action="${SCRIPT}/search.html">
            <input type="hidden" name="rsid" value="${resultSet.id}"/>
            <select name="sortBy">
                % for val, label in [('weight', 'Relevance'), ('/*/*/did/unittitle', 'Title')]:
                    % if val in sortBy:
                    <option value="${val}" selected="selected">${label}</option>
                    % else:
                    <option value="${val}">${label}</option>
                    % endif
                    
                % endfor
            </select>
        </form>
    </div>
</%def>

<%def name="maximumRecordsSelect(resultSet, sortBy, maximumRecords, startRecord)">
    <div class="maximumRecords">
        <a 
            href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=20#leftcol"
            class="ajax maximumRecords">
            20
        </a>
        % if len(resultSet) >= 100:
            <a 
                href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=50#leftcol"
                class="ajax maximumRecords">
                50
            </a>
        % endif
        % if len(resultSet) >= 200:
            <a 
                href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=100#leftcol"
                class="ajax maximumRecords">
                100
            </a>
        % endif
        <a 
            href="${SCRIPT}/search.html?rsid=${resultSet.id|u}&amp;startRecord=${startRecord}&amp;maximumRecords=${len(resultSet)}#leftcol"
            class="ajax maximumRecords">
            all
        </a>
    </div>
</%def>

<%def name="format_resultSetItem(resultSet, sortBy, maximumRecords, startRecord, index)">
    <%
    rec = resultSet[index].fetch_record(session)
    %>
    ## Check for potential component-level record
    % try:
        <%
        parentId = rec.process_xpath(session,
                                     '/c3component/@parent')[0]
        %>
        ## OK, must be a component record
        <img src="${SCRIPT}/img/folderOpen.gif" alt="|/`/">
    % except IndexError:
        ## Collection level
    % endtry
    <%
    try:
        titleEl = rec.process_xpath(session,
                                    '/*/*/did/unittitle')[0]
    except IndexError:
        xp = '/ead/eadheader/filedesc/titlestmt/titleproper'
        try:
            titleEl = rec.process_xpath(session, xp)[0]
        except IndexError:
            titleEl = '(untitled)'
    try:
        title = flattenTexts(titleEl)
    except AttributeError:
        title = titleEl
    %>
    <a \
        href="${SCRIPT}/summary.html?rsid=${resultSet.id}&amp;hit=${index}&amp;startRecord=${startRecord}&amp;maximumRecords=${maximumRecords}">
        ${title}
    </a>
    ## Relevance
</%def>
